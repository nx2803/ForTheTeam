generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model follows {
  id         Int       @id @default(autoincrement())
  member_uid String?   @db.Uuid
  team_id    String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamp(6)
  members    members?  @relation(fields: [member_uid], references: [uid], onDelete: Cascade, onUpdate: NoAction)
  teams      teams     @relation(fields: [team_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model leagues {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String
  category   String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  logo_url   String?
  teams      teams[]
  matches    matches[]
}

model members {
  uid                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email                 String    @unique @db.VarChar(255)
  hashed_password       String    @db.VarChar(255)
  nickname              String    @db.VarChar(100)
  main_favorite_team_id String?   @db.Uuid
  joined_at             DateTime? @default(now()) @db.Timestamp(6)
  follows               follows[]
  teams                 teams?    @relation(fields: [main_favorite_team_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model teams {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  league_id       String    @db.Uuid
  name            String
  logo_url        String?
  primary_color   String?
  secondary_color String?
  external_api_id String?   @unique
  abbreviation    String?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  follows         follows[]
  members         members[]
  leagues         leagues   @relation(fields: [league_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  home_matches    matches[] @relation("home_matches")
  away_matches    matches[] @relation("away_matches")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model todos {
  id        BigInt   @id @default(autoincrement())
  text      String?  @db.VarChar
  completed Boolean? @default(false)
}

model restaurants {
  UC_SEQ                  BigInt    @id
  MAIN_TITLE              String?
  GUGUN_NM                String?
  LAT                     Float?
  LNG                     Float?
  PLACE                   String?
  TITLE                   String?
  SUBTITLE                String?
  ADDR1                   String?
  ADDR2                   String?
  CNTCT_TEL               String?
  HOMEPAGE_URL            String?
  USAGE_DAY_WEEK_AND_TIME String?
  RPRSNTV_MENU            String?
  MAIN_IMG_NORMAL         String?
  MAIN_IMG_THUMB          String?
  ITEMCNTNTS              String?
  created_at              DateTime? @default(now()) @db.Timestamptz(6)
}

model matches {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  league_id       String    @db.Uuid
  home_team_id    String?   @db.Uuid
  away_team_id    String?   @db.Uuid
  home_team_name  String?   // 외부 API 데이터 백업용 (DB에 팀이 없을 경우 대비)
  away_team_name  String?
  match_at        DateTime  @db.Timestamptz(6)
  status          String    @default("scheduled") // scheduled, ongoing, finished, cancelled
  home_score      Int       @default(0)
  away_score      Int       @default(0)
  external_api_id String    @unique
  venue           String?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  leagues    leagues  @relation(fields: [league_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  home_team  teams?   @relation("home_matches", fields: [home_team_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  away_team  teams?   @relation("away_matches", fields: [away_team_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
